<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Practical 03 - Multiple linear regression and model residuals</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="tutorial.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Biol 520C Statistical modelling for biological data &mdash; UBC-Okanagan</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Lectures.html">Lectures</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Practicals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01_R_Introduction.html">Practical 01</a>
    </li>
    <li>
      <a href="02_Regression.html">Practical 02</a>
    </li>
    <li>
      <a href="03_MLR_Residuals.html">Practical 03</a>
    </li>
    <li>
      <a href="04_Visualisation.html">Practical 04</a>
    </li>
    <li>
      <a href="05_MEM_Model_Selection.html">Practical 05</a>
    </li>
    <li>
      <a href="06_Heteroskedasticity_Autocorrelation.html">Practical 06</a>
    </li>
    <li>
      <a href="07_Spatial_and_Phylogenetic_Autocorrelation.html">Practical 07</a>
    </li>
    <li>
      <a href="08_GLMs_for_Count_Data.html">Practical 08</a>
    </li>
    <li>
      <a href="09_Logistic_Regression.html">Practical 09</a>
    </li>
    <li>
      <a href="10_Stochastic_Simulation.html">Practical 10</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Datasets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Practical_Datasets.html">Practicals</a>
    </li>
    <li>
      <a href="Paper_Datasets.html">Papers</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    R Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Plotting.html">Plotting</a>
    </li>
    <li>
      <a href="for_loops.html">for loops</a>
    </li>
    <li>
      <a href="Simulation.html">Simulation</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Practical 03 - Multiple linear regression
and model residuals</h1>

</div>


<hr />
<div id="background" class="section level2">
<h2>Background</h2>
<p>In this Practical you will:</p>
<ul>
<li>Fit a multiple linear regression model to empirical data.</li>
<li>Use simulated data to explore the difference between R-squared and
adjusted R-squared</li>
<li>Explore the residuals of models for data with heteroskedastic
errors</li>
<li>Explore the residuals of models for data with lots of 0 entries</li>
</ul>
<p>You are asked to complete the following exercises and submit to
Canvas before the deadline. In addition to the points detailed below, 5
points are assigned to the cleanliness of the code and resulting pdf
document. Only knit documents (.pdf, .doc, or .html) will be accepted.
Unknit .Rmd files will not be graded.</p>
<hr />
</div>
<div id="multiple-linear-regression-model" class="section level2">
<h2>Multiple linear regression model</h2>
<p>For most biological systems there are typically multiple variables
that influence outcomes. To account for this, we fit multiple-linear
regression models to our data. Multiple linear regression models
typically take the form:</p>
<center>
<span class="math inline">\(y_i = \beta_0 + \beta_1 x_1 + \beta_2 x_2 +
... \beta_m x_m + \varepsilon_i\)</span>
</center>
<p></br></p>
<p>, where <span class="math inline">\(y_i\)</span> represents our
response variable (indexed by <span class="math inline">\(i\)</span>),
<span class="math inline">\(beta_0 ... beta_n\)</span> represent the
regression coefficients that we are trying to estimate, <span
class="math inline">\(x_1 ... x_n\)</span> represent our predictor
variables, and <span class="math inline">\(varepsilon_i\)</span> our
error (indexed by <span class="math inline">\(i\)</span>). Assuming this
model structure is appropriate for our system, the challenge is
accurately estimating the regression coefficients from our data.</p>
<p></br></p>
<p>In this practical we will explore multiple linear regression using
data that were collected by <a
href="https://www.ardeola.org/es/volumenes/492/articulos/211-221/">Carrascal
and Palomino</a> to explore the influence of island characteristics and
the abundance of terrestrial bird species in Selvagem and the Canary
Islands. Carrascal and Palomino compiled data from the peer reviewed
literature to explore whether factors such as an island’s size, distance
to the mainland, diversity of habitats, etc… correlated with terrestrial
bird species diversity. The dataset includes a number of different
measures, but here we will be focusing on i) <code>bird_species</code>,
the number of terrestrial bird species found on each island; ii)
<code>island_area</code>, the area of each island (in km<span
class="math inline">\(^2\)</span>); iii) <code>maximum_altitude</code>,
the maximum altitude on each island (in meters), and iv)
<code>habitat_diversity</code>, which is a unitless metric based on the
Shannon-Weaver index that represents the diversity different habitat
types on each island.</p>
<ol style="list-style-type: decimal">
<li>6 points
<ol></li>
</ol>
<ul>
<li>Import the Island_Biogeography dataset.</li>
<li>Use the <code>plot()</code> and <code>cor()</code> functions to
check for any correlations between the 3 predictor variables;
<code>island_area</code>, <code>maximum_altitude</code>, and
<code>habitat_diversity</code>. – 1 point(s)</li>
<li>Describe the outcome. Is there any cause for concern? Are there any
variables you should consider dropping? Why/why not? – 1 point(s)</li>
<li>Fit a simple linear regression model to model the relationship
between <code>bird_species</code> and <code>island_area</code>. – 1
point(s)</li>
<li>Manually calculate the the ordinary residuals, then compare them to
the output of the <code>residuals()</code> function. – 1 point(s)</li>
<li>Plot the ordinary residuals against the fitted values, plot a
histogram of the ordinary residuals, describe what you see. – 0.5
point(s)</li>
<li>Fit a model that includes all of the predictor variables from
<code>island_area</code>, <code>maximum_altitude</code>, and
<code>habitat_diversity</code> that you feel should be included based on
your previous analyses. what happened to the R-squared? – 1
point(s)</li>
<li>Plot and inspect the ordinary residuals, describe what you see. –
0.5 point(s)
</ol></li>
</ul>
<pre class="r"><code>data &lt;- read.csv(&quot;https://noonanm.github.io/Biol520C/Practical_Datasets/Island_Biogeography.csv&quot;)</code></pre>
<hr />
</div>
<div id="r-squared-and-adjusted-r-squared" class="section level2">
<h2>R-squared and adjusted R-squared</h2>
<div id="r-squared" class="section level3">
<h3>R-squared</h3>
<p>The residuals measure how accurately a fitted model predicts the
observed data, and they are also used to calculate the coefficient of
determination (i.e., R-squared). A model’s R-squared value is the
proportion of the variance in the response variable that is predictable
from the predictor(s). You will often see ecologists say things like our
model explained 87% of the variance in our response variable. In most
cases they are getting this number from a model’s R-squared.</p>
<ol style="list-style-type: decimal">
<li>2 points
<ol></li>
</ol>
<ul>
<li>Manually calculate the R-squared value for the full model you just
fit to the bird species abundance data. – 1 point(s)</li>
<li>Compare this value to the output of <code>summary()</code>. – 1
point(s)
</ol></li>
</ul>
<p>The problem with R-squared values is that they don’t take into
account the number of parameters in the model. If we keep adding
meaningless parameters to a model to soak up some of the residual
variation, the R-square will necessarily decrease, which can trick us
into thinking we have a better model.</p>
<ol style="list-style-type: decimal">
<li>4 points
<ol></li>
</ol>
<ul>
<li>Make a figure showing the relationship between island age and bird
diversity. From these data, do you think that island age is driving bird
diversity. – 1 point(s)</li>
<li>Refit the model you previously fit, but now include
<code>island_age</code>. What happened to the R-squared? Is this a
meaningful measure of model performance? – 1 point(s)</li>
<li>Generate 12 randomly distributed numbers from a distribution of your
choice. Add these to your dataset, and refit the model you just fit but
now include these random numbers. Describe the effect on the R-squared.
– 2 point(s)
</ol></li>
</ul>
</div>
<div id="adjusted-r-squared" class="section level3">
<h3>Adjusted R-squared</h3>
<p>When you add more parameters to the model, the r-squared converges to
1. This suggests that we have an increasingly better model, but we know
for a fact that it will do this even if the parameters are just noise.
The reason for this is that the R-squared value doesn’t factor in the
number of parameters in the model. As a correction, the adjusted
R-square is ‘adjusted’ based on the number of parameters in the
model.</p>
<ol style="list-style-type: decimal">
<li>2 points
<ol></li>
</ol>
<ul>
<li>Compare the adjusted R-squared value you obtained in exercise 2,
with that from the model with the random noise. Describe what you see
now. – 2 point(s)
</ol></li>
</ul>
<hr />
</div>
</div>
<div id="heteroskedasticity" class="section level2">
<h2>Heteroskedasticity</h2>
<div id="problem" class="section level4">
<h4>Problem</h4>
<p>Sometime data will exhibit “heteroscedasticity”, meaning that the
residuals (i.e., variance in the data that is not explained by the
model) get larger as the prediction moves from small to large values of
x (or from large to small).</p>
<ol style="list-style-type: decimal">
<li>3 points
<ol></li>
</ol>
<ul>
<li>Describe how the following function works to generate
heteroskedastic data: – 1 point(s)</li>
</ul>
<pre class="r"><code>hetero &lt;- function(x) {
  B_0 &lt;- 0
  B_1 &lt;- 2
  sigma = x^2
  eps = rnorm(x,mean=0,sd=sqrt(sigma))
  y = B_0 + B_1*x + eps
  y
}</code></pre>
<ul>
<li>Use this function to generate 400 uniformly sampled data points
between 1 and 60. – 0.5 point(s)</li>
<li>Plot the data and describe what you see. – 0.5 point(s)</li>
<li>Fit a model to these data. – 0.5 point(s)</li>
<li>Plot the residuals against the fitted values and describe the
effect. – 0.5 point(s)
</ol></li>
</ul>
</div>
<div id="implications" class="section level3">
<h3>Implications</h3>
<p>Heteroskedasticity on its own does not inherently create a problem
(notice the parameter estimates), but it’s often an indication that your
model can be improved. Importantly, if your sample size is small, and
you can’t fix the issue, your p-values may be a bit be a bit higher or
lower than they should be, so possibly a variable that is right on the
border of significance may end up erroneously on the wrong side of that
border. Your regression coefficients will still be generally accurate
though. The accuracy of any of your predictions will also be off (either
too narrow, or too wide), depending on where you fall along the
x-axis.</p>
</div>
<div id="how-to-solve-the-issue" class="section level3">
<h3>How to solve the issue</h3>
<ul>
<li><p>The most frequent suggestion is to transform a variable,
however…</p></li>
<li><p>More often than not, heteroscedasticity indicates that your model
is missing a component and transformations are attempt to mask
interesting features rather than incorporate them into your
model.</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>2 points
<ol></li>
</ol>
<ul>
<li>Attempt to fix the heteroscedasticity in these data by square root
transforming the y values. – 0.5 point(s)</li>
<li>Plot the transformed data and fitted regression line. – 0.5
point(s)</li>
<li>Plot the residuals against the fitted values and describe the effect
of the transformation. – 1 point(s)
</ol></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
